cc._loaderImage = "data:image/PEG;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/4QMtaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDIxRjQ1Rjk4REY3MTFFNEJFRDhFOUQwN0ZFRDk5MEMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDIxRjQ1RkE4REY3MTFFNEJFRDhFOUQwN0ZFRDk5MEMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowMjFGNDVGNzhERjcxMUU0QkVEOEU5RDA3RkVEOTkwQyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMjFGNDVGODhERjcxMUU0QkVEOEU5RDA3RkVEOTkwQyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABALCwsMCxAMDBAXDw0PFxsU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";

var LoadingScene = cc.Scene.extend({
	_interval : null,
	_label : null,
	_className:"LoadingScene",
	/**
	 * Contructor of cc.LoaderScene
	 * @returns {boolean}
	 */
	init : function(){
		var self = this;
		//logo
		var logoWidth = 180;
		var logoHeight = 214;

		// bg
		var bgLayer = self._bgLayer = new cc.LayerColor(cc.color(0, 0, 0, 255));
		self.addChild(bgLayer, 0);

		//image move to CCSceneFile.js
		var lblHeight =  -logoHeight / 2 + 100;
		if(cc._loaderImage){
			//loading logo
			cc.loader.loadImg(cc._loaderImage, {isCrossOrigin : false }, function(err, img){
				logoWidth = img.width;
				logoHeight = img.height;
				self._initStage(img, cc.visibleRect.center);
			});
			fontSize = 14;
			lblHeight = -logoHeight / 2 - 40;
		}
		//loading percent
		var label = self._label = new cc.LabelTTF("努力加载中... 0%", "Arial", 32);
		label.setPosition(cc.pAdd(cc.visibleRect.center, cc.p(0, lblHeight)));
		label.setColor(cc.color(180, 180, 180));
		bgLayer.addChild(this._label, 10);
		return true;
	},

	_initStage: function (img, centerPos) {
		var self = this;
		var texture2d = self._texture2d = new cc.Texture2D();
		texture2d.initWithElement(img);
		texture2d.handleLoadedTexture();
		var logo = self._logo = new cc.Sprite(texture2d);
		logo.setScale(cc.contentScaleFactor());
		logo.x = centerPos.x;
		logo.y = centerPos.y;
		self._bgLayer.addChild(logo, 10);
	},
	/**
	 * custom onEnter
	 */
	 onEnter: function () {
		 var self = this;
		 cc.Node.prototype.onEnter.call(self);
		 self.schedule(self._startLoading, 0.3);
	 },
	 /**
	  * custom onExit
	  */
	 onExit: function () {
		 cc.Node.prototype.onExit.call(this);
		 var tmpStr = "努力加载中... 0%";
		 this._label.setString(tmpStr);
	 },

	 /**
	  * init with resources
	  * @param {Array} resources
	  * @param {Function|String} cb
	  */
	 initWithResources: function (resources, cb) {
		 if(cc.isString(resources))
			 resources = [resources];
		 this.resources = resources || [];
		 this.cb = cb;
	 },

	 _startLoading: function () {
		 var self = this;
		 self.unschedule(self._startLoading);
		 var res = self.resources;
		 cc.loader.load(res,
				 function (result, count, loadedCount) {
			 var percent = (loadedCount / count * 100) | 0;
			 percent = Math.min(percent, 100);
			 self._label.setString("努力加载中... " + percent + "%");
			 // console.log("percent:", percent)
		 }, function () {
			 if (self.cb)
				 self.cb();
		 });
	 }
});

LoadingScene.preload = function(resources, cb){
	var loadingScene = new LoadingScene();
	loadingScene.init();
	loadingScene.initWithResources(resources, cb);

	cc.director.runScene(loadingScene);
	return loadingScene;
};